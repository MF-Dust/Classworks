import{g as B,p as R,N as I,a2 as H,u as z,a4 as D,a1 as F,ae as U,k as j,S as $,b as O,c as t,n as G,a8 as J,ac as K,d as Y,_ as N,f as u,o,w as s,C as l,B as p,z as i,A as f,E as S,G as h,D as M,H as T,I as A,r as q}from"./index-CXuoiuhD.js";import{a as Q,b as v,V as C,g as L,e as x,d as X}from"./VRow-B1eTMxyG.js";import{V as Z,a as ee,c as ae,d as se,f as te,g as re}from"./VSpacer-C8ryX8xR.js";import{V as _}from"./VAlert-C64aEu_S.js";import{V as le,a as ne,b as ie,c as oe}from"./VExpansionPanels-DHSptfC6.js";import"./ssrBoot-m1Fxwm88.js";const ce={actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, heading","card-avatar":"image, list-item-avatar",chip:"chip","date-picker":"list-item, heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",divider:"divider",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",ossein:"ossein",paragraph:"text@3",sentences:"text@2",subtitle:"text",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"chip, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"text@6","table-tfoot":"text@2, avatar@2",text:"text"};function de(a){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t("div",{class:["v-skeleton-loader__bone",`v-skeleton-loader__${a}`]},[e])}function W(a){const[e,r]=a.split("@");return Array.from({length:r}).map(()=>k(e))}function k(a){let e=[];if(!a)return e;const r=ce[a];if(a!==r){if(a.includes(","))return E(a);if(a.includes("@"))return W(a);r.includes(",")?e=E(r):r.includes("@")?e=W(r):r&&e.push(k(r))}return[de(a,e)]}function E(a){return a.replace(/\s/g,"").split(",").map(k)}const ue=R({boilerplate:Boolean,color:String,loading:Boolean,loadingText:{type:String,default:"$vuetify.loading"},type:{type:[String,Array],default:"ossein"},...Y(),...K(),...J()},"VSkeletonLoader"),me=B()({name:"VSkeletonLoader",props:ue(),setup(a,e){let{slots:r}=e;const{backgroundColorClasses:m,backgroundColorStyles:n}=I(H(a,"color")),{dimensionStyles:d}=z(a),{elevationClasses:c}=D(a),{themeClasses:g}=F(a),{t:y}=U(),w=j(()=>k($(a.type).join(",")));return O(()=>{var V;const b=!r.default||a.loading,P=a.boilerplate||!b?{}:{ariaLive:"polite",ariaLabel:y(a.loadingText),role:"alert"};return t("div",G({class:["v-skeleton-loader",{"v-skeleton-loader--boilerplate":a.boilerplate},g.value,m.value,c.value],style:[n.value,b?d.value:{}]},P),[b?w.value:(V=r.default)==null?void 0:V.call(r)])}),{}}}),ge={name:"CacheManager",data(){return{caches:[],loading:!1,serviceWorkerActive:!1,message:"",messageType:"info"}},mounted(){this.checkServiceWorker()},methods:{checkServiceWorker(){"serviceWorker"in navigator?navigator.serviceWorker.ready.then(()=>{this.serviceWorkerActive=!0,this.refreshCaches()}).catch(()=>{this.serviceWorkerActive=!1}):this.serviceWorkerActive=!1},async refreshCaches(){if(this.serviceWorkerActive){this.loading=!0,this.message="",this.caches=[];try{const a=await this.sendMessageToSW({type:"CACHE_KEYS"});for(const e of a.cacheNames){const r=await this.sendMessageToSW({type:"CACHE_CONTENT",cacheName:e});this.caches.push({name:e,urls:r.urls||[]})}}catch(a){this.showMessage("获取缓存信息失败: "+a.message,"error")}finally{this.loading=!1}}},async clearCache(a){this.loading=!0;try{(await this.sendMessageToSW({type:"CLEAR_CACHE",cacheName:a})).success?(this.showMessage(`已清除缓存: ${this.formatCacheName(a)}`,"success"),await this.refreshCaches()):this.showMessage("清除缓存失败","error")}catch(e){this.showMessage("清除缓存失败: "+e.message,"error")}finally{this.loading=!1}},async clearUrl(a,e){this.loading=!0;try{(await this.sendMessageToSW({type:"CLEAR_URL",cacheName:a,url:e})).success?(this.showMessage(`已从缓存中删除: ${this.getFileName(e)}`,"success"),await this.refreshCaches()):this.showMessage("删除缓存项失败","error")}catch(r){this.showMessage("删除缓存项失败: "+r.message,"error")}finally{this.loading=!1}},async clearAllCaches(){if(confirm("确定要清除所有缓存吗？这可能会导致应用需要重新下载资源。")){this.loading=!0;try{(await this.sendMessageToSW({type:"CLEAR_ALL_CACHES"})).success?(this.showMessage("已清除所有缓存","success"),await this.refreshCaches()):this.showMessage("清除所有缓存失败","error")}catch(a){this.showMessage("清除所有缓存失败: "+a.message,"error")}finally{this.loading=!1}}},sendMessageToSW(a){return new Promise((e,r)=>{if(!navigator.serviceWorker.controller){r(new Error("Service Worker 未控制页面"));return}const m=new MessageChannel;m.port1.onmessage=n=>{e(n.data)},navigator.serviceWorker.controller.postMessage(a,[m.port2]),setTimeout(()=>{r(new Error("Service Worker 响应超时"))},5e3)})},formatCacheName(a){return a.replace("workbox-precache-","预缓存-").replace("-cache","").replace("js","JS").replace("css","CSS").replace("html","HTML").replace("images","图片").replace("external-resources","外部资源").replace("cdn-cgi","CDN")},getFileName(a){try{const e=new URL(a),r=e.pathname.split("/");return r[r.length-1]||e.hostname}catch(e){return console.error("获取文件名失败:",e),a}},showMessage(a,e="info"){this.message=a,this.messageType=e,setTimeout(()=>{this.message===a&&(this.message="")},5e3)}}},fe={class:"d-flex align-center"},he={class:"d-flex justify-end mb-2"};function pe(a,e,r,m,n,d){return o(),u(C,null,{default:s(()=>[t(Q,{class:"d-flex align-center"},{default:s(()=>[e[2]||(e[2]=l("span",null,"缓存管理",-1)),t(Z),t(p,{color:"error",onClick:d.clearAllCaches,loading:n.loading},{default:s(()=>e[0]||(e[0]=[i(" 清除所有缓存 ")])),_:1},8,["onClick","loading"]),t(p,{icon:"",class:"ml-2",onClick:d.refreshCaches},{default:s(()=>[t(f,null,{default:s(()=>e[1]||(e[1]=[i("mdi-refresh")])),_:1})]),_:1},8,["onClick"])]),_:1}),t(v,null,{default:s(()=>[n.serviceWorkerActive?S("",!0):(o(),u(_,{key:0,type:"warning",class:"mb-4"},{default:s(()=>e[3]||(e[3]=[i(" Service Worker 未激活，缓存管理功能不可用。 ")])),_:1})),n.message?(o(),u(_,{key:1,type:n.messageType,class:"mb-4"},{default:s(()=>[i(h(n.message),1)]),_:1},8,["type"])):S("",!0),n.caches.length>0?(o(),u(le,{key:2},{default:s(()=>[(o(!0),M(T,null,A(n.caches,c=>(o(),u(ne,{key:c.name},{default:s(()=>[t(ie,null,{default:s(()=>[l("div",fe,[l("span",null,h(d.formatCacheName(c.name)),1),t(ee,{class:"ml-2",size:"small"},{default:s(()=>[i(h(c.urls.length)+" 个文件",1)]),_:2},1024)])]),_:2},1024),t(oe,null,{default:s(()=>[l("div",he,[t(p,{color:"error",size:"small",onClick:g=>d.clearCache(c.name),loading:n.loading},{default:s(()=>e[4]||(e[4]=[i(" 清除此缓存 ")])),_:2},1032,["onClick","loading"])]),t(ae,{lines:"two"},{default:s(()=>[(o(!0),M(T,null,A(c.urls,(g,y)=>(o(),u(se,{key:y},{append:s(()=>[t(p,{icon:"",size:"small",color:"error",onClick:w=>d.clearUrl(c.name,g)},{default:s(()=>[t(f,null,{default:s(()=>e[5]||(e[5]=[i("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),default:s(()=>[t(te,{class:"text-truncate"},{default:s(()=>[i(h(d.getFileName(g)),1)]),_:2},1024),t(re,{class:"text-truncate"},{default:s(()=>[i(h(g),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):n.loading?(o(),u(me,{key:3,type:"article"})):(o(),u(_,{key:4,type:"info"},{default:s(()=>e[6]||(e[6]=[i(" 没有找到缓存数据。 ")])),_:1}))]),_:1})]),_:1})}const ve=N(ge,[["render",pe]]),Ce={name:"CacheManagementPage",components:{CacheManager:ve},metaInfo:{title:"缓存管理"}},ke={class:"d-flex align-center mb-6"},ye={class:"d-flex align-center mb-2"},be={class:"d-flex align-center mb-2"};function xe(a,e,r,m,n,d){const c=q("CacheManager");return o(),u(X,null,{default:s(()=>[t(L,null,{default:s(()=>[t(x,{cols:"12"},{default:s(()=>[l("div",ke,[t(f,{size:"x-large",color:"primary",class:"mr-3"},{default:s(()=>e[0]||(e[0]=[i("mdi-database-cog-outline")])),_:1}),e[1]||(e[1]=l("div",null,[l("h1",{class:"text-h4"},"缓存管理"),l("div",{class:"text-subtitle-1 text-grey"},"管理应用的本地缓存资源")],-1))]),t(C,{class:"mb-6",variant:"tonal",color:"info",density:"compact"},{default:s(()=>[t(v,{class:"d-flex align-center"},{default:s(()=>[t(f,{color:"info",class:"mr-2"},{default:s(()=>e[2]||(e[2]=[i("mdi-information-outline")])),_:1}),e[3]||(e[3]=l("span",null,"在这里您可以查看和管理应用的缓存文件。清除缓存可能会导致应用需要重新下载资源，但有助于解决某些显示问题。",-1))]),_:1})]),_:1}),t(L,null,{default:s(()=>[t(x,{cols:"12",md:"8"},{default:s(()=>[t(C,{class:"mb-4",variant:"tonal"},{default:s(()=>[t(v,null,{default:s(()=>[l("div",ye,[t(f,{color:"primary",class:"mr-2"},{default:s(()=>e[4]||(e[4]=[i("mdi-information")])),_:1}),e[5]||(e[5]=l("span",{class:"text-h6"},"什么是缓存？",-1))]),e[6]||(e[6]=l("p",null,"缓存是浏览器在本地存储的网站资源副本，如图片、脚本和样式表等。这些缓存可以加快页面加载速度，减少数据使用，并在离线时提供基本功能。",-1))]),_:1})]),_:1})]),_:1}),t(x,{cols:"12",md:"4"},{default:s(()=>[t(C,{class:"mb-4",variant:"tonal"},{default:s(()=>[t(v,null,{default:s(()=>[l("div",be,[t(f,{color:"warning",class:"mr-2"},{default:s(()=>e[7]||(e[7]=[i("mdi-lightbulb-outline")])),_:1}),e[8]||(e[8]=l("span",{class:"text-h6"},"何时清除缓存？",-1))]),e[9]||(e[9]=l("ul",{class:"pl-4"},[l("li",null,"应用显示过时的内容"),l("li",null,"界面出现异常"),l("li",null,"应用功能不正常")],-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(c)]),_:1})]),_:1})]),_:1})}const Ae=N(Ce,[["render",xe]]);export{Ae as default};
