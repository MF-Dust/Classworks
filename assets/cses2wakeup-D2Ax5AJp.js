import{g as O,p as U,J as $,ad as Ke,b as z,ae as Ce,c as u,x as N,Q as he,Y as xe,K as Se,B as A,af as pe,L as X,O as F,P as _e,F as S,ag as Pe,X as Ie,ah as Qe,ai as Ze,k as Y,A as $e,aj as et,ak as tt,al as De,aa as st,Z as nt,am as lt,N as ue,an as Ae,ao as ot,ab as at,m as Be,e as Ee,ap as it,aq as Re,ar as rt,as as ut,at as dt,M as ct,au as ft,av as ht,C as de,aw as vt,D as yt,ax as mt,ay as kt,az as pt,aA as bt,_ as gt,f as J,o as r,w as b,i as g,q as p,v,n as d,l as P,y as M}from"./index-Co3nJdql.js";import{h as oe,e as q,V as ae,a as ie,f as wt,b as re,g as Tt,d as Vt}from"./VRow-l3sFO9V_.js";import{V as be}from"./VAlert-D77jKsDK.js";import{u as Ct}from"./ssrBoot-gyfxiZHJ.js";import{a as We,h as ge,m as xt,V as St}from"./VSpacer-Dk5eErFK.js";import{V as we,m as _t,a as Pt,b as Te,c as It}from"./VTextarea-K6D8XG4p.js";import{u as Ne,b as Q,m as Fe,c as Ve,d as Dt,e as At,a as Bt}from"./VTextField-CYXbqfUk.js";const Et=U({...Fe(),...he(_t(),["inline"])},"VCheckbox"),Rt=O()({name:"VCheckbox",inheritAttrs:!1,props:Et(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,s){let{attrs:a,slots:o}=s;const n=$(e,"modelValue"),{isFocused:c,focus:t,blur:l}=Ne(e),i=Ke();return z(()=>{const[y,T]=Ce(a),f=Q.filterProps(e),m=we.filterProps(e);return u(Q,N({class:["v-checkbox",e.class]},y,f,{modelValue:n.value,"onUpdate:modelValue":h=>n.value=h,id:e.id||`checkbox-${i}`,focused:c.value,style:e.style}),{...o,default:h=>{let{id:k,messagesId:C,isDisabled:I,isReadonly:_,isValid:B}=h;return u(we,N(m,{id:k.value,"aria-describedby":C.value,disabled:I.value,readonly:_.value},T,{error:B.value===!1,modelValue:n.value,"onUpdate:modelValue":R=>n.value=R,onFocus:t,onBlur:l}),o)}})}),{}}}),Wt=U({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...Fe({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>Se(e).every(s=>s!=null&&typeof s=="object")},...At({clearable:!0})},"VFileInput"),Nt=O()({name:"VFileInput",inheritAttrs:!1,props:Wt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{attrs:a,emit:o,slots:n}=s;const{t:c}=xe(),t=$(e,"modelValue",e.modelValue,w=>Se(w),w=>!e.multiple&&Array.isArray(w)?w[0]:w),{isFocused:l,focus:i,blur:y}=Ne(e),T=A(()=>typeof e.showSize!="boolean"?e.showSize:void 0),f=A(()=>(t.value??[]).reduce((w,D)=>{let{size:H=0}=D;return w+H},0)),m=A(()=>pe(f.value,T.value)),h=A(()=>(t.value??[]).map(w=>{const{name:D="",size:H=0}=w;return e.showSize?`${D} (${pe(H,T.value)})`:D})),k=A(()=>{var D;const w=((D=t.value)==null?void 0:D.length)??0;return e.showSize?c(e.counterSizeString,w,m.value):c(e.counterString,w)}),C=X(),I=X(),_=X(),B=F(()=>l.value||e.active),R=A(()=>["plain","underlined"].includes(e.variant));function V(){var w;_.value!==document.activeElement&&((w=_.value)==null||w.focus()),l.value||i()}function x(w){var D;(D=_.value)==null||D.click()}function E(w){o("mousedown:control",w)}function W(w){var D;(D=_.value)==null||D.click(),o("click:control",w)}function ee(w){w.stopPropagation(),V(),Ie(()=>{t.value=[],Qe(e["onClick:clear"],w)})}function te(w){w.preventDefault()}function j(w){w.preventDefault(),w.dataTransfer&&(t.value=[...w.dataTransfer.files??[]])}return _e(t,w=>{(!Array.isArray(w)||!w.length)&&_.value&&(_.value.value="")}),z(()=>{const w=!!(n.counter||e.counter),D=!!(w||n.details),[H,se]=Ce(a),{modelValue:ne,...ze}=Q.filterProps(e),He=Ve.filterProps(e);return u(Q,N({ref:C,modelValue:e.multiple?t.value:t.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":R.value},e.class],style:e.style,"onClick:prepend":x},H,ze,{centerAffix:!R.value,focused:l.value}),{...n,default:le=>{let{id:K,isDisabled:G,isDirty:ye,isReadonly:me,isValid:Xe}=le;return u(Ve,N({ref:I,"prepend-icon":e.prependIcon,onMousedown:E,onClick:W,"onClick:clear":ee,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},He,{id:K.value,active:B.value||ye.value,dirty:ye.value||e.dirty,disabled:G.value,focused:l.value,error:Xe.value===!1,onDragover:te,onDrop:j}),{...n,default:Ye=>{var ke;let{props:{class:Ge,...Je}}=Ye;return u(S,null,[u("input",N({ref:_,type:"file",readonly:me.value,disabled:G.value,multiple:e.multiple,name:e.name,onClick:L=>{L.stopPropagation(),me.value&&L.preventDefault(),V()},onChange:L=>{if(!L.target)return;const qe=L.target;t.value=[...qe.files??[]]},onFocus:V,onBlur:y},Je,se),null),u("div",{class:Ge},[!!((ke=t.value)!=null&&ke.length)&&!e.hideInput&&(n.selection?n.selection({fileNames:h.value,totalBytes:f.value,totalBytesReadable:m.value}):e.chips?h.value.map(L=>u(We,{key:L,size:"small",text:L},null)):h.value.join(", "))])])}})},details:D?le=>{var K,G;return u(S,null,[(K=n.details)==null?void 0:K.call(n,le),w&&u(S,null,[u("span",null,null),u(Dt,{active:!!((G=t.value)!=null&&G.length),value:k.value,disabled:e.disabled},n.counter)])])}:void 0})}),Pe({},C,I,_)}}),ve=Symbol.for("vuetify:v-tabs"),Ft=U({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...he($e({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),ce=O()({name:"VTab",props:Ft(),setup(e,s){let{slots:a,attrs:o}=s;const{textColorClasses:n,textColorStyles:c}=Ze(()=>e.sliderColor),t=X(),l=X(),i=A(()=>e.direction==="horizontal"),y=A(()=>{var f,m;return((m=(f=t.value)==null?void 0:f.group)==null?void 0:m.isSelected.value)??!1});function T(f){var h,k;let{value:m}=f;if(m){const C=(k=(h=t.value)==null?void 0:h.$el.parentElement)==null?void 0:k.querySelector(".v-tab--selected .v-tab__slider"),I=l.value;if(!C||!I)return;const _=getComputedStyle(C).color,B=C.getBoundingClientRect(),R=I.getBoundingClientRect(),V=i.value?"x":"y",x=i.value?"X":"Y",E=i.value?"right":"bottom",W=i.value?"width":"height",ee=B[V],te=R[V],j=ee>te?B[E]-R[E]:B[V]-R[V],w=Math.sign(j)>0?i.value?"right":"bottom":Math.sign(j)<0?i.value?"left":"top":"center",H=(Math.abs(j)+(Math.sign(j)<0?B[W]:R[W]))/Math.max(B[W],R[W])||0,se=B[W]/R[W]||0,ne=1.5;et(I,{backgroundColor:[_,"currentcolor"],transform:[`translate${x}(${j}px) scale${x}(${se})`,`translate${x}(${j/ne}px) scale${x}(${(H-1)/ne+1})`,"none"],transformOrigin:Array(3).fill(w)},{duration:225,easing:tt})}}return z(()=>{const f=Y.filterProps(e);return u(Y,N({symbol:ve,ref:t,class:["v-tab",e.class],style:e.style,tabindex:y.value?0:-1,role:"tab","aria-selected":String(y.value),active:!1},f,o,{block:e.fixed,maxWidth:e.fixed?300:void 0,"onGroup:selected":T}),{...a,default:()=>{var m;return u(S,null,[((m=a.default)==null?void 0:m.call(a))??e.text,!e.hideSlider&&u("div",{ref:l,class:["v-tab__slider",n.value],style:c.value},null)])}})}),Pe({},t)}}),jt=e=>{const{touchstartX:s,touchendX:a,touchstartY:o,touchendY:n}=e,c=.5,t=16;e.offsetX=a-s,e.offsetY=n-o,Math.abs(e.offsetY)<c*Math.abs(e.offsetX)&&(e.left&&a<s-t&&e.left(e),e.right&&a>s+t&&e.right(e)),Math.abs(e.offsetX)<c*Math.abs(e.offsetY)&&(e.up&&n<o-t&&e.up(e),e.down&&n>o+t&&e.down(e))};function Lt(e,s){var o;const a=e.changedTouches[0];s.touchstartX=a.clientX,s.touchstartY=a.clientY,(o=s.start)==null||o.call(s,{originalEvent:e,...s})}function Mt(e,s){var o;const a=e.changedTouches[0];s.touchendX=a.clientX,s.touchendY=a.clientY,(o=s.end)==null||o.call(s,{originalEvent:e,...s}),jt(s)}function Ot(e,s){var o;const a=e.changedTouches[0];s.touchmoveX=a.clientX,s.touchmoveY=a.clientY,(o=s.move)==null||o.call(s,{originalEvent:e,...s})}function Ut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:e.left,right:e.right,up:e.up,down:e.down,start:e.start,move:e.move,end:e.end};return{touchstart:a=>Lt(a,s),touchend:a=>Mt(a,s),touchmove:a=>Ot(a,s)}}function zt(e,s){var l;const a=s.value,o=a!=null&&a.parent?e.parentElement:e,n=(a==null?void 0:a.options)??{passive:!0},c=(l=s.instance)==null?void 0:l.$.uid;if(!o||!c)return;const t=Ut(s.value);o._touchHandlers=o._touchHandlers??Object.create(null),o._touchHandlers[c]=t,De(t).forEach(i=>{o.addEventListener(i,t[i],n)})}function Ht(e,s){var c,t;const a=(c=s.value)!=null&&c.parent?e.parentElement:e,o=(t=s.instance)==null?void 0:t.$.uid;if(!(a!=null&&a._touchHandlers)||!o)return;const n=a._touchHandlers[o];De(n).forEach(l=>{a.removeEventListener(l,n[l])}),delete a._touchHandlers[o]}const je={mounted:zt,unmounted:Ht},Le=Symbol.for("vuetify:v-window"),Me=Symbol.for("vuetify:v-window-group"),Oe=U({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||e==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...Ee(),...Be(),...at()},"VWindow"),fe=O()({name:"VWindow",directives:{Touch:je},props:Oe(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:a}=s;const{themeClasses:o}=st(e),{isRtl:n}=nt(),{t:c}=xe(),t=lt(e,Me),l=X(),i=A(()=>n.value?!e.reverse:e.reverse),y=ue(!1),T=A(()=>{const V=e.direction==="vertical"?"y":"x",E=(i.value?!y.value:y.value)?"-reverse":"";return`v-window-${V}${E}-transition`}),f=ue(0),m=X(void 0),h=A(()=>t.items.value.findIndex(V=>t.selected.value.includes(V.id)));_e(h,(V,x)=>{const E=t.items.value.length,W=E-1;E<=2?y.value=V<x:V===W&&x===0?y.value=!0:V===0&&x===W?y.value=!1:y.value=V<x}),it(Le,{transition:T,isReversed:y,transitionCount:f,transitionHeight:m,rootRef:l});const k=F(()=>e.continuous||h.value!==0),C=F(()=>e.continuous||h.value!==t.items.value.length-1);function I(){k.value&&t.prev()}function _(){C.value&&t.next()}const B=A(()=>{const V=[],x={icon:n.value?e.nextIcon:e.prevIcon,class:`v-window__${i.value?"right":"left"}`,onClick:t.prev,"aria-label":c("$vuetify.carousel.prev")};V.push(k.value?a.prev?a.prev({props:x}):u(Y,x,null):u("div",null,null));const E={icon:n.value?e.prevIcon:e.nextIcon,class:`v-window__${i.value?"left":"right"}`,onClick:t.next,"aria-label":c("$vuetify.carousel.next")};return V.push(C.value?a.next?a.next({props:E}):u(Y,E,null):u("div",null,null)),V}),R=A(()=>e.touch===!1?e.touch:{...{left:()=>{i.value?I():_()},right:()=>{i.value?_():I()},start:x=>{let{originalEvent:E}=x;E.stopPropagation()}},...e.touch===!0?{}:e.touch});return z(()=>Ae(u(e.tag,{ref:l,class:["v-window",{"v-window--show-arrows-on-hover":e.showArrows==="hover"},o.value,e.class],style:e.style},{default:()=>{var V,x;return[u("div",{class:"v-window__container",style:{height:m.value}},[(V=a.default)==null?void 0:V.call(a,{group:t}),e.showArrows!==!1&&u("div",{class:"v-window__controls"},[B.value])]),(x=a.additional)==null?void 0:x.call(a,{group:t})]}}),[[ot("touch"),R.value]])),{group:t}}}),Xt=U({...he(Oe(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),Yt=O()({name:"VTabsWindow",props:Xt(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:a}=s;const o=Re(ve,null),n=$(e,"modelValue"),c=A({get(){var t;return n.value!=null||!o?n.value:(t=o.items.value.find(l=>o.selected.value.includes(l.id)))==null?void 0:t.value},set(t){n.value=t}});return z(()=>{const t=fe.filterProps(e);return u(fe,N({_as:"VTabsWindow"},t,{modelValue:c.value,"onUpdate:modelValue":l=>c.value=l,class:["v-tabs-window",e.class],style:e.style,mandatory:!1,touch:!1}),a)}),{}}}),Ue=U({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...Ee(),...ht(),...ft()},"VWindowItem"),Z=O()({name:"VWindowItem",directives:{Touch:je},props:Ue(),emits:{"group:selected":e=>!0},setup(e,s){let{slots:a}=s;const o=Re(Le),n=rt(e,Me),{isBooted:c}=Ct();if(!o||!n)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const t=ue(!1),l=A(()=>c.value&&(o.isReversed.value?e.reverseTransition!==!1:e.transition!==!1));function i(){!t.value||!o||(t.value=!1,o.transitionCount.value>0&&(o.transitionCount.value-=1,o.transitionCount.value===0&&(o.transitionHeight.value=void 0)))}function y(){var k;t.value||!o||(t.value=!0,o.transitionCount.value===0&&(o.transitionHeight.value=de((k=o.rootRef.value)==null?void 0:k.clientHeight)),o.transitionCount.value+=1)}function T(){i()}function f(k){t.value&&Ie(()=>{!l.value||!t.value||!o||(o.transitionHeight.value=de(k.clientHeight))})}const m=A(()=>{const k=o.isReversed.value?e.reverseTransition:e.transition;return l.value?{name:typeof k!="string"?o.transition.value:k,onBeforeEnter:y,onAfterEnter:i,onEnterCancelled:T,onBeforeLeave:y,onAfterLeave:i,onLeaveCancelled:T,onEnter:f}:!1}),{hasContent:h}=ut(e,n.isSelected);return z(()=>u(ct,{transition:m.value,disabled:!c.value},{default:()=>{var k;return[Ae(u("div",{class:["v-window-item",n.selectedClass.value,e.class],style:e.style},[h.value&&((k=a.default)==null?void 0:k.call(a))]),[[dt,n.isSelected.value]])]}})),{groupItem:n}}}),Gt=U({...Ue()},"VTabsWindowItem"),Jt=O()({name:"VTabsWindowItem",props:Gt(),setup(e,s){let{slots:a}=s;return z(()=>{const o=Z.filterProps(e);return u(Z,N({_as:"VTabsWindowItem"},o,{class:["v-tabs-window-item",e.class],style:e.style}),a)}),{}}});function qt(e){return e?e.map(s=>bt(s)?s:{text:s,value:s}):[]}const Kt=U({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...xt({mandatory:"force",selectedClass:"v-tab-item--selected"}),...pt(),...Be()},"VTabs"),Qt=O()({name:"VTabs",props:Kt(),emits:{"update:modelValue":e=>!0},setup(e,s){let{attrs:a,slots:o}=s;const n=$(e,"modelValue"),c=A(()=>qt(e.items)),{densityClasses:t}=vt(e),{backgroundColorClasses:l,backgroundColorStyles:i}=yt(()=>e.bgColor),{scopeId:y}=mt();return kt({VTab:{color:F(()=>e.color),direction:F(()=>e.direction),stacked:F(()=>e.stacked),fixed:F(()=>e.fixedTabs),sliderColor:F(()=>e.sliderColor),hideSlider:F(()=>e.hideSlider)}}),z(()=>{const T=ge.filterProps(e),f=!!(o.window||e.items.length>0);return u(S,null,[u(ge,N(T,{modelValue:n.value,"onUpdate:modelValue":m=>n.value=m,class:["v-tabs",`v-tabs--${e.direction}`,`v-tabs--align-tabs-${e.alignTabs}`,{"v-tabs--fixed-tabs":e.fixedTabs,"v-tabs--grow":e.grow,"v-tabs--stacked":e.stacked},t.value,l.value,e.class],style:[{"--v-tabs-height":de(e.height)},i.value,e.style],role:"tablist",symbol:ve},y,a),{default:()=>{var m;return[((m=o.default)==null?void 0:m.call(o))??c.value.map(h=>{var k;return((k=o.tab)==null?void 0:k.call(o,{item:h}))??u(ce,N(h,{key:h.text,value:h.value}),{default:o[`tab.${h.value}`]?()=>{var C;return(C=o[`tab.${h.value}`])==null?void 0:C.call(o,{item:h})}:void 0})})]}}),f&&u(Yt,N({modelValue:n.value,"onUpdate:modelValue":m=>n.value=m,key:"tabs-window"},y),{default:()=>{var m;return[c.value.map(h=>{var k;return((k=o.item)==null?void 0:k.call(o,{item:h}))??u(Jt,{value:h.value},{default:()=>{var C;return(C=o[`item.${h.value}`])==null?void 0:C.call(o,{item:h})}})}),(m=o.window)==null?void 0:m.call(o)]}})])}),{}}}),Zt={name:"Cses2Wakeup",data(){return{activeTab:"text",file:null,jsonText:"",loading:!1,error:"",success:"",processedData:null,selectedRows:[],selectedPeriodIds:[],exportPeriods:[],selectedSchedules:{},settings:{hideIndoorLocation:!1,hideTeacherName:!1,totalWeeks:30},courseColors:{语文:"red",数学:"blue",英语:"green",物理:"purple",化学:"orange",生物:"teal",历史:"brown",地理:"indigo",政治:"pink",体育:"cyan",自习:"grey",早读:"amber",班会:"deep-purple",听力:"light-blue",答疑:"lime",信息技术:"light-green"},tableHeaders:[{title:"",key:"data-table-select"},{title:"节次",key:"period"},{title:"周一",key:"1"},{title:"周二",key:"2"},{title:"周三",key:"3"},{title:"周四",key:"4"},{title:"周五",key:"5"},{title:"周六",key:"6"},{title:"周日",key:"7"}]}},methods:{handleFileChange(){this.error="",this.success="",this.processedData=null,this.jsonText="",this.selectedRows=[],this.selectedPeriodIds=[],this.exportPeriods=[],this.selectedSchedules={}},handleTextChange(){this.error="",this.success="",this.processedData=null,this.file=null,this.selectedRows=[],this.selectedPeriodIds=[],this.exportPeriods=[],this.selectedSchedules={}},async processInput(){if(!this.file&&!this.jsonText){this.error="请选择文件或粘贴JSON文本";return}this.loading=!0,this.error="",this.success="";try{let e;if(this.activeTab==="file"){const a=await this.file.text();e=new Function("return "+a)().default.data}else try{e=JSON.parse(this.jsonText)}catch{throw new Error("JSON格式不正确，请检查输入")}e.schedules&&(e.schedules=this.assignUniqueIds(e.schedules)),this.selectedSchedules={},e.schedules&&e.schedules.forEach(a=>{this.selectedSchedules[a.uuid]=!1});const s=this.processScheduleData(e);this.processedData={...this.processedData,tableData:s.tableData,schedules:e.schedules,processedData:e},this.success="数据处理成功！"}catch(e){this.error="数据处理失败："+e.message,console.error(e)}finally{this.loading=!1}},downloadCSV(){var t;if(!((t=this.processedData)!=null&&t.tableData)){this.error="没有可下载的数据";return}let e=`课程名称,星期,开始节数,结束节数,老师,地点,周数
`;if(this.exportPeriods.length===0){this.error="请至少选择一节要导出的课";return}const s=this.processedData.tableData.filter(l=>this.exportPeriods.includes(l.period));s.sort((l,i)=>l.period-i.period);let a=0;s.forEach((l,i)=>{for(let y=1;y<=7;y++){const T=l[y];if(Array.isArray(T))T.forEach(f=>{if(f&&f.name){a++;const m=this.settings.hideIndoorLocation&&f.location==="教室"?"":f.location||"",h=this.settings.hideTeacherName?"":f.teacher||"",k=f.weekType?`1-${this.settings.totalWeeks}${f.weekType}`:`1-${this.settings.totalWeeks}`;e+=`${f.name},${y},${l.period},${l.period},${h},${m},${k}
`}});else if(T&&T.name){a++;const f=this.settings.hideIndoorLocation&&T.location==="教室"?"":T.location||"",m=this.settings.hideTeacherName?"":T.teacher||"",h=T.weekType?`1-${this.settings.totalWeeks}${T.weekType}`:`1-${this.settings.totalWeeks}`;e+=`${T.name},${y},${l.period},${l.period},${m},${f},${h}
`}}});const o="\uFEFF",n=new Blob([o+e],{type:"text/csv;charset=utf-8"}),c=document.createElement("a");c.href=URL.createObjectURL(n),c.download=`course_schedule_${a}课时.csv`,c.click(),URL.revokeObjectURL(c.href),this.success=`导出成功！共计 ${a} 课时`},getCourseColor(e){return this.courseColors[e]||"grey"},updateProcessedData(){if(!this.processedData)return;const e=this.processedData.processedData,s=this.processScheduleData(e);this.processedData={...this.processedData,tableData:s.tableData}},updateSelectedPeriods(e){this.selectedPeriodIds=[],e&&e.length>0&&(this.selectedPeriodIds=[...new Set(e.filter(s=>s&&typeof s.period=="number").map(s=>s.period))]),this.exportPeriods=[...this.selectedPeriodIds]},toggleExportPeriod(e){const s=this.exportPeriods.indexOf(e);s===-1?this.exportPeriods.push(e):this.exportPeriods.splice(s,1)},isExportPeriod(e){return this.exportPeriods.includes(e)},processScheduleData(e){if(e.schedules&&Array.isArray(e.schedules))return this.processNewFormatData(e);if(e.Subjects&&e.TimeLayouts)return this.processOldFormatData(e);throw new Error("数据格式不正确")},processNewFormatData(e){const{schedules:s,subjects:a}=e,o=[];let n=12;s.forEach(t=>{t.classes&&t.classes.length>n&&(n=t.classes.length)});for(let t=1;t<=n;t++)o.push({period:t,1:null,2:null,3:null,4:null,5:null,6:null,7:null});this.selectedRows=[...o],this.selectedPeriodIds=o.map(t=>t.period),this.exportPeriods=[...this.selectedPeriodIds];const c=s.filter(t=>this.selectedSchedules[t.uuid]===!0);return c.length===0?{tableData:o,processedData:e}:(c.forEach(t=>{const l=String(t.enable_day);if(!l||l<1||l>7)return;let i="";t.weeks==="odd"?i="单":t.weeks==="even"&&(i="双"),t.classes.forEach((y,T)=>{if(!y.subject)return;const f=T+1;if(f>n)return;let m="";if(a&&Array.isArray(a)){const C=a.find(I=>I.name===y.subject);C&&(m=C.teacher||"")}const h={name:y.subject,teacher:m,location:"",period:f,startTime:y.start_time,endTime:y.end_time,weekday:t.name,weekType:i},k=o[f-1][l];k?i&&k.weekType&&i!==k.weekType&&(Array.isArray(o[f-1][l])||(o[f-1][l]=[k]),o[f-1][l].push(h)):o[f-1][l]=h})}),{tableData:o,processedData:e})},processOldFormatData(e){if(!e||!e.Subjects||!e.TimeLayouts)throw new Error("数据格式不正确");const s=e.Subjects,a=e.TimeLayouts,o=e.ClassPlans||{},n=[];let c=100;for(const l in a){const i=a[l];let y=0;i.Layouts.forEach(T=>{T.TimeType===0&&y++}),c=Math.max(c,y)}for(let l=1;l<=c;l++)n.push({period:l,1:null,2:null,3:null,4:null,5:null,6:null,7:null});this.selectedRows=[...n],this.selectedPeriodIds=n.map(l=>l.period),this.exportPeriods=[...this.selectedPeriodIds];const t={};for(const l in o){const i=o[l];i.TimeLayoutId&&(t[i.TimeLayoutId]=i)}for(const l in a){const i=a[l];let y=i.Name,T="",f="";const m=t[l];if(y.startsWith("Odd_")?(T="单",y=y.replace("Odd_","")):y.startsWith("Even_")&&(T="双",y=y.replace("Even_","")),m&&m.TimeRule){const k=m.TimeRule.WeekDay;f=k===0?"7":String(k),m.TimeRule.WeekCountDiv&&m.TimeRule.WeekCountDivTotal&&(m.TimeRule.WeekCountDiv===1&&m.TimeRule.WeekCountDivTotal===2?T="单":m.TimeRule.WeekCountDiv===2&&m.TimeRule.WeekCountDivTotal===2&&(T="双"))}else if(f=this.weekdayMap[y],!f)continue;let h=0;i.Layouts.forEach(k=>{const C=k.DefaultClassId;if(s[C]&&k.TimeType===0){const I=s[C];h++;const _={name:I.Name,teacher:I.TeacherName||"",location:I.IsOutDoor?"户外":"教室",period:h,startTime:k.StartSecond.substr(11,5),endTime:k.EndSecond.substr(11,5),weekday:y,weekType:T};if(h<=c&&f){const B=n[h-1][f];B&&T?B.weekType!==T&&(Array.isArray(n[h-1][f])||(n[h-1][f]=[B]),n[h-1][f].push(_)):n[h-1][f]=_}}})}return{tableData:n,processedData:e}},getCourseByDayAndPeriod(e,s){var a,o;return(a=this.processedData)!=null&&a.periodCourses&&((o=this.processedData.periodCourses[s])==null?void 0:o[e])||null},toggleScheduleSelection(e){var c;if(!e||!e.uuid)return;const s=!!this.selectedSchedules[e.uuid],a={...this.selectedSchedules};if(s){a[e.uuid]=!1,this.selectedSchedules=a,this.updateProcessedData();return}const o=e.enable_day,n=e.weeks;(c=this.processedData)!=null&&c.schedules&&this.processedData.schedules.forEach(t=>{if(t.uuid===e.uuid||t.enable_day!==o)return;const l=t.weeks;let i=!1;n==="odd"&&l==="even"||n==="even"&&l==="odd"?i=!1:(n==="all"||l==="all"||n===l)&&(i=!0),i&&a[t.uuid]&&(a[t.uuid]=!1)}),a[e.uuid]=!0,this.selectedSchedules=a,this.updateProcessedData()},assignUniqueIds(e){if(!e||!Array.isArray(e))return e;const s={};e.forEach(o=>{const n=o.enable_day,c=o.weeks||"all",t=`${n}_${c}`;s[t]||(s[t]=[]),s[t].push(o)});const a=[];return Object.values(s).forEach(o=>{o.forEach((n,c)=>{const t={...n},l=n.enable_day,i=n.weeks||"all";t.uuid=`schedule_${l}_${i}_${c}_${Date.now()}`,a.push(t)})}),a}},computed:{weekdayMap(){return{周一:"1",周二:"2",周三:"3",周四:"4",周五:"5",周六:"6",周日:"7",Monday:"1",Tuesday:"2",Wednesday:"3",Thursday:"4",Friday:"5",Saturday:"6",Sunday:"7"}},maxPeriods(){if(!this.processedData)return[];let e=0;for(const s in this.processedData.statistics){const a=this.processedData.statistics[s].courses;a.length>0&&(e=Math.max(e,...a.map(o=>o.period)))}return Array.from({length:e},(s,a)=>a+1)}}},$t={key:0},es={key:0},ts={class:"d-flex flex-wrap"},ss={key:0,class:"ml-1"},ns={key:0,class:"course-cell"},ls={key:0},os={key:1,class:"week-type"},as={key:0},is={key:1,class:"week-type"},rs={key:0,class:"course-cell"},us={key:0},ds={key:1,class:"week-type"},cs={key:0},fs={key:1,class:"week-type"},hs={key:0,class:"course-cell"},vs={key:0},ys={key:1,class:"week-type"},ms={key:0},ks={key:1,class:"week-type"},ps={key:0,class:"course-cell"},bs={key:0},gs={key:1,class:"week-type"},ws={key:0},Ts={key:1,class:"week-type"},Vs={key:0,class:"course-cell"},Cs={key:0},xs={key:1,class:"week-type"},Ss={key:0},_s={key:1,class:"week-type"},Ps={key:0,class:"course-cell"},Is={key:0},Ds={key:1,class:"week-type"},As={key:0},Bs={key:1,class:"week-type"},Es={key:0,class:"course-cell"},Rs={key:0},Ws={key:1,class:"week-type"},Ns={key:0},Fs={key:1,class:"week-type"};function js(e,s,a,o,n,c){return r(),J(Vt,{class:"fill-height"},{default:b(()=>[u(oe,null,{default:b(()=>[u(q,{cols:"12"},{default:b(()=>[u(ae,{class:"elevation-12",border:""},{default:b(()=>[u(ie,null,{default:b(()=>s[11]||(s[11]=[g(" 课程表转换工具 ")])),_:1}),u(wt,null,{default:b(()=>s[12]||(s[12]=[g(" 请在CSES中将数据格式改为“通用CSES(JSON)” ")])),_:1}),u(re,null,{default:b(()=>[n.error?(r(),J(be,{key:0,type:"error",class:"mb-4",closable:"","onClick:close":s[0]||(s[0]=t=>n.error="")},{default:b(()=>[g(v(n.error),1)]),_:1})):p("",!0),n.success?(r(),J(be,{key:1,type:"success",class:"mb-4",closable:"","onClick:close":s[1]||(s[1]=t=>n.success="")},{default:b(()=>[g(v(n.success),1)]),_:1})):p("",!0),u(Qt,{modelValue:n.activeTab,"onUpdate:modelValue":s[2]||(s[2]=t=>n.activeTab=t),class:"mb-4"},{default:b(()=>[u(ce,{value:"text"},{default:b(()=>s[13]||(s[13]=[g("文本粘贴")])),_:1}),u(ce,{value:"file",disabled:""},{default:b(()=>s[14]||(s[14]=[g("文件上传")])),_:1})]),_:1},8,["modelValue"]),u(fe,{modelValue:n.activeTab,"onUpdate:modelValue":s[5]||(s[5]=t=>n.activeTab=t)},{default:b(()=>[u(Z,{value:"text"},{default:b(()=>[u(Pt,{modelValue:n.jsonText,"onUpdate:modelValue":s[3]||(s[3]=t=>n.jsonText=t),label:"粘贴JSON文本",loading:n.loading,disabled:n.loading,"row-height":"25",rows:"3",placeholder:"请在此粘贴JSON格式的课程表数据...",onInput:c.handleTextChange},null,8,["modelValue","loading","disabled","onInput"])]),_:1}),u(Z,{value:"file"},{default:b(()=>[u(Nt,{modelValue:n.file,"onUpdate:modelValue":s[4]||(s[4]=t=>n.file=t),accept:".js,.json",label:"选择课程表文件","prepend-icon":"mdi-file-upload",loading:n.loading,disabled:n.loading,onChange:c.handleFileChange,rules:[t=>!t||t.size<2e6||"文件大小不能超过 2 MB"]},null,8,["modelValue","loading","disabled","onChange","rules"])]),_:1})]),_:1},8,["modelValue"]),u(ae,{class:"mb-4",outlined:""},{default:b(()=>[u(ie,{class:"text-subtitle-1"},{default:b(()=>s[15]||(s[15]=[g(" 课程设置 ")])),_:1}),u(re,null,{default:b(()=>[n.processedData?(r(),d("div",$t,[s[17]||(s[17]=P("div",{class:"text-subtitle-2 mb-2"},"导出设置",-1)),u(oe,null,{default:b(()=>[u(q,{cols:"12",sm:"6"},{default:b(()=>[u(Te,{modelValue:n.settings.hideIndoorLocation,"onUpdate:modelValue":s[6]||(s[6]=t=>n.settings.hideIndoorLocation=t),label:"室内课程不显示地点",color:"primary"},null,8,["modelValue"])]),_:1}),u(q,{cols:"12",sm:"6"},{default:b(()=>[u(Te,{modelValue:n.settings.hideTeacherName,"onUpdate:modelValue":s[7]||(s[7]=t=>n.settings.hideTeacherName=t),label:"不显示教师姓名",color:"primary"},null,8,["modelValue"])]),_:1}),u(q,{cols:"12",sm:"6"},{default:b(()=>[u(Bt,{modelValue:n.settings.totalWeeks,"onUpdate:modelValue":s[8]||(s[8]=t=>n.settings.totalWeeks=t),modelModifiers:{number:!0},label:"总周数",type:"number",min:"1",max:"30",rules:[t=>t>0||"周数必须大于0"],dense:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),n.processedData.schedules&&n.processedData.schedules.length>0?(r(),d("div",es,[s[16]||(s[16]=P("div",{class:"text-subtitle-2 mb-2"},"课表选择",-1)),u(oe,null,{default:b(()=>[u(q,{cols:"12"},{default:b(()=>[P("div",ts,[(r(!0),d(S,null,M(n.processedData.schedules,t=>(r(),J(We,{key:t.uuid,color:n.selectedSchedules[t.uuid]?"primary":"grey",outlined:!n.selectedSchedules[t.uuid],"input-value":n.selectedSchedules[t.uuid],"prepend-icon":n.selectedSchedules[t.uuid]?"mdi-check":"",class:"ma-1",onClick:l=>c.toggleScheduleSelection(t),filter:""},{default:b(()=>[g(v(t.name)+" ",1),t.weeks==="odd"||t.weeks==="even"?(r(),d("span",ss," ("+v(t.weeks==="odd"?"单":"双")+"周) ",1)):p("",!0)]),_:2},1032,["color","outlined","input-value","prepend-icon","onClick"]))),128))])]),_:1})]),_:1})])):p("",!0)])):p("",!0)]),_:1})]),_:1}),n.processedData?(r(),J(ae,{key:2,class:"mt-4",outlined:""},{default:b(()=>[u(ie,{class:"text-subtitle-1"},{default:b(()=>s[18]||(s[18]=[g(" 处理结果预览 ")])),_:1}),u(re,null,{default:b(()=>[s[33]||(s[33]=P("div",{class:"text-subtitle-2 mb-2"},"每周课程表",-1)),u(It,{"items-selected":n.selectedRows,"onUpdate:itemsSelected":[s[10]||(s[10]=t=>n.selectedRows=t),c.updateSelectedPeriods],headers:n.tableHeaders,items:n.processedData.tableData,"hide-default-footer":"",class:"elevation-1","items-per-page":-1,"item-value":"period","show-select":"","select-strategy":"single-independent"},{"item.data-table-select":b(({item:t})=>[u(Rt,{modelValue:n.exportPeriods,"onUpdate:modelValue":s[9]||(s[9]=l=>n.exportPeriods=l),value:t.period,"hide-details":"",density:"compact"},null,8,["modelValue","value"])]),"item.1":b(({item:t})=>[t[1]?(r(),d("div",ns,[Array.isArray(t[1])?(r(!0),d(S,{key:0},M(t[1],(l,i)=>(r(),d("div",{key:i,class:"course-item"},[g(v(l.name)+" ",1),!n.settings.hideTeacherName&&l.teacher?(r(),d("span",ls,[s[19]||(s[19]=P("br",null,null,-1)),g(v(l.teacher),1)])):p("",!0),l.weekType?(r(),d("span",os,v(l.weekType)+"周 ",1)):p("",!0)]))),128)):(r(),d(S,{key:1},[g(v(t[1].name)+" ",1),!n.settings.hideTeacherName&&t[1].teacher?(r(),d("span",as,[s[20]||(s[20]=P("br",null,null,-1)),g(v(t[1].teacher),1)])):p("",!0),t[1].weekType?(r(),d("span",is,v(t[1].weekType)+"周 ",1)):p("",!0)],64))])):p("",!0)]),"item.2":b(({item:t})=>[t[2]?(r(),d("div",rs,[Array.isArray(t[2])?(r(!0),d(S,{key:0},M(t[2],(l,i)=>(r(),d("div",{key:i,class:"course-item"},[g(v(l.name)+" ",1),!n.settings.hideTeacherName&&l.teacher?(r(),d("span",us,[s[21]||(s[21]=P("br",null,null,-1)),g(v(l.teacher),1)])):p("",!0),l.weekType?(r(),d("span",ds,v(l.weekType)+"周 ",1)):p("",!0)]))),128)):(r(),d(S,{key:1},[g(v(t[2].name)+" ",1),!n.settings.hideTeacherName&&t[2].teacher?(r(),d("span",cs,[s[22]||(s[22]=P("br",null,null,-1)),g(v(t[2].teacher),1)])):p("",!0),t[2].weekType?(r(),d("span",fs,v(t[2].weekType)+"周 ",1)):p("",!0)],64))])):p("",!0)]),"item.3":b(({item:t})=>[t[3]?(r(),d("div",hs,[Array.isArray(t[3])?(r(!0),d(S,{key:0},M(t[3],(l,i)=>(r(),d("div",{key:i,class:"course-item"},[g(v(l.name)+" ",1),!n.settings.hideTeacherName&&l.teacher?(r(),d("span",vs,[s[23]||(s[23]=P("br",null,null,-1)),g(v(l.teacher),1)])):p("",!0),l.weekType?(r(),d("span",ys,v(l.weekType)+"周 ",1)):p("",!0)]))),128)):(r(),d(S,{key:1},[g(v(t[3].name)+" ",1),!n.settings.hideTeacherName&&t[3].teacher?(r(),d("span",ms,[s[24]||(s[24]=P("br",null,null,-1)),g(v(t[3].teacher),1)])):p("",!0),t[3].weekType?(r(),d("span",ks,v(t[3].weekType)+"周 ",1)):p("",!0)],64))])):p("",!0)]),"item.4":b(({item:t})=>[t[4]?(r(),d("div",ps,[Array.isArray(t[4])?(r(!0),d(S,{key:0},M(t[4],(l,i)=>(r(),d("div",{key:i,class:"course-item"},[g(v(l.name)+" ",1),!n.settings.hideTeacherName&&l.teacher?(r(),d("span",bs,[s[25]||(s[25]=P("br",null,null,-1)),g(v(l.teacher),1)])):p("",!0),l.weekType?(r(),d("span",gs,v(l.weekType)+"周 ",1)):p("",!0)]))),128)):(r(),d(S,{key:1},[g(v(t[4].name)+" ",1),!n.settings.hideTeacherName&&t[4].teacher?(r(),d("span",ws,[s[26]||(s[26]=P("br",null,null,-1)),g(v(t[4].teacher),1)])):p("",!0),t[4].weekType?(r(),d("span",Ts,v(t[4].weekType)+"周 ",1)):p("",!0)],64))])):p("",!0)]),"item.5":b(({item:t})=>[t[5]?(r(),d("div",Vs,[Array.isArray(t[5])?(r(!0),d(S,{key:0},M(t[5],(l,i)=>(r(),d("div",{key:i,class:"course-item"},[g(v(l.name)+" ",1),!n.settings.hideTeacherName&&l.teacher?(r(),d("span",Cs,[s[27]||(s[27]=P("br",null,null,-1)),g(v(l.teacher),1)])):p("",!0),l.weekType?(r(),d("span",xs,v(l.weekType)+"周 ",1)):p("",!0)]))),128)):(r(),d(S,{key:1},[g(v(t[5].name)+" ",1),!n.settings.hideTeacherName&&t[5].teacher?(r(),d("span",Ss,[s[28]||(s[28]=P("br",null,null,-1)),g(v(t[5].teacher),1)])):p("",!0),t[5].weekType?(r(),d("span",_s,v(t[5].weekType)+"周 ",1)):p("",!0)],64))])):p("",!0)]),"item.6":b(({item:t})=>[t[6]?(r(),d("div",Ps,[Array.isArray(t[6])?(r(!0),d(S,{key:0},M(t[6],(l,i)=>(r(),d("div",{key:i,class:"course-item"},[g(v(l.name)+" ",1),!n.settings.hideTeacherName&&l.teacher?(r(),d("span",Is,[s[29]||(s[29]=P("br",null,null,-1)),g(v(l.teacher),1)])):p("",!0),l.weekType?(r(),d("span",Ds,v(l.weekType)+"周 ",1)):p("",!0)]))),128)):(r(),d(S,{key:1},[g(v(t[6].name)+" ",1),!n.settings.hideTeacherName&&t[6].teacher?(r(),d("span",As,[s[30]||(s[30]=P("br",null,null,-1)),g(v(t[6].teacher),1)])):p("",!0),t[6].weekType?(r(),d("span",Bs,v(t[6].weekType)+"周 ",1)):p("",!0)],64))])):p("",!0)]),"item.7":b(({item:t})=>[t[7]?(r(),d("div",Es,[Array.isArray(t[7])?(r(!0),d(S,{key:0},M(t[7],(l,i)=>(r(),d("div",{key:i,class:"course-item"},[g(v(l.name)+" ",1),!n.settings.hideTeacherName&&l.teacher?(r(),d("span",Rs,[s[31]||(s[31]=P("br",null,null,-1)),g(v(l.teacher),1)])):p("",!0),l.weekType?(r(),d("span",Ws,v(l.weekType)+"周 ",1)):p("",!0)]))),128)):(r(),d(S,{key:1},[g(v(t[7].name)+" ",1),!n.settings.hideTeacherName&&t[7].teacher?(r(),d("span",Ns,[s[32]||(s[32]=P("br",null,null,-1)),g(v(t[7].teacher),1)])):p("",!0),t[7].weekType?(r(),d("span",Fs,v(t[7].weekType)+"周 ",1)):p("",!0)],64))])):p("",!0)]),_:2},1032,["items-selected","headers","items","onUpdate:itemsSelected"])]),_:1})]),_:1})):p("",!0)]),_:1}),u(Tt,{class:"pa-4"},{default:b(()=>[u(St),u(Y,{color:"primary",loading:n.loading,disabled:!n.file&&!n.jsonText||n.loading,onClick:c.processInput},{default:b(()=>s[34]||(s[34]=[g(" 处理数据 ")])),_:1},8,["loading","disabled","onClick"]),u(Y,{color:"success",disabled:!n.processedData,onClick:c.downloadCSV},{default:b(()=>s[35]||(s[35]=[g(" 下载CSV ")])),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Ys=gt(Zt,[["render",js],["__scopeId","data-v-e1373d7d"]]);export{Ys as default};
